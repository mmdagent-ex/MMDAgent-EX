---
title: Python連携
---

Python スクリプト等の任意のプログラムと MMDAgent-EX を直接つなぐことができる。
これには Plugin_AnyScript プラグインを使う。

## 概要

Plugin_AnyScript プラグインは、指定されたコマンドを子プロセスとして起動する。このとき、起動したプロセスの標準入出力は MMDAgent-EX のメッセージキューと接続される。これによって、MMDAgent-EX に投げ込まれる全てのメッセージの監視やそれに対する外部処理の定義が行える。また、何か処理をした結果を MMDAgent-EX 内部へメッセージとして投げ込むことができる。

## プログラム作成上の注意

**標準出力のバッファリングを OFF にすること**。バッファリングが ON になっていると、出力したメッセージが即座に MMDAgent-EX に吐き出されず、処理が行われなかったり遅延したりする。Python スクリプトの場合は必ず起動時オプションに -u をつけること。それ以外の場合は、１行出力するごとに明示的に出力をフラッシュするようプログラムを作成すること。

## 設定方法

.mdf で設定する。サブプロセスとして起動するコマンドを以下の形で指定する。
なお実行時のカレントディレクトリは MMDAgent-EX.exe の置いてあるフォルダになる
（コンテンツではないので注意）

```text
Plugin_AnyScript_Command=C:\Program Files\Python310\python.exe -u test.py
```

最初の `=` から行末までの全ての文字が起動コマンドとして使われる。空白があってもＯＫ。

複数のプロセスを起動したい場合は以下のように書く。

```text
Plugin_AnyScript_Command1=...
Plugin_AnyScript_Command2=...
```

デフォルトでは標準入力で受け取れるのは「メッセージ」のみだが、すべての動作ログを受け取りたい場合は以下を .mdf に指定する。

```text
Plugin_AnyScript_AllLog=true
```
